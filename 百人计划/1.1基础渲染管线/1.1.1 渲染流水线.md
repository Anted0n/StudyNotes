# 1.1.1 渲染流水线
## 目录
* 应用阶段
* 几何阶段
* 光栅化阶段
* 逐片元操作
* 后处理
## 应用阶段
### 准备基本场景数据
准备场景需要渲染的基本内容
* 场景物体数据
    * 变换
    * 网格
* 摄像机数据
    * 位置、方向、远近裁剪平面
    * 正交 / 透视
    * 视口比例 / 尺寸
* 光源数据
    * 光源类型
    * 其他参数
* 其他全局数据
### 加速算法/粗粒度剔除
对渲染过程进行加速，或是去掉不需要渲染的物体
* 可见光裁剪
* 可见场景物体裁剪
    * 八叉树
    * BSP树
    * K-D树
    * BVH
### 渲染设置
物体渲染的基本设置
* 绘制设置
    * 着色器
    * 合批方式
* 绘制顺序
    * 相对摄像机距离
    * 材质RenderQueue
    * UICanvas
* 渲染目标
    * FrameBuffer
    * RenderTexture
* 渲染模式
    * 前向渲染
    * 延迟渲染
### 输出到显存
从CPU到GPU，进行后续渲染
* 顶点数据
    * 位置
    * 颜色
    * 法线
    * 纹理uv坐标
    * 其他
* 其他数据
    * MVP变换矩阵
    * 纹理贴图
    * 其他数据
## 几何阶段
### 顶点着色器
物体从物体空间→世界空间→观察空间→裁剪空间，可编程
* 视图变换
* 顶点着色
### 可选处理
* 曲面细分
* 几何着色器
### 投影
将物体从裁剪空间进行透视除法，转换到标准设备坐标系(NDC)的图元
* 正交
* 透视
### 裁剪
裁剪渲染范围以外的顶点
* CVV
* 正面/背面剔除
* 坐标系差异(OpenGL/D3D)
### 屏幕映射
将标准设备坐标系下的图元转换到屏幕坐标系的比例
* 连续到离散
* 坐标系差异(OpenGL/D3D)
## 光栅化阶段
### 三角形设置
计算图元的边界信息
### 三角形遍历
寻找在图元(三角形)范围内的像素，根据顶点进行线性插值计算像素信息
### 抗锯齿 (MSAA) (可选)
原理：每个像素设置多个子采样点用于检测是否被三角形覆盖
## 逐片元操作
### 片元着色器
可编程
### 颜色混合
对覆盖相同像素的多个片元 通过一系列测试进行取舍
* 透明度测试
* 深度测试
* 模板测试
* 混合
### 目标缓冲区
输出渲染结果到目标缓冲区
* FrameBuffer
* RenderTexture